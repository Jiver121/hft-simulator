# Real-Time Progress Tracking in ExecutionSimulator

The ExecutionSimulator now includes comprehensive real-time progress tracking functionality that provides visual feedback during backtest execution, showing order generation and trade execution counts in real-time.

## Features

### Core Progress Tracking
- **Real-time progress bar**: Visual indication of backtest completion percentage
- **Order counter**: Live count of orders generated by strategies
- **Trade counter**: Live count of trades executed through the matching engine
- **Processing rate**: Current ticks processed per second
- **ETA calculation**: Estimated time to completion based on current processing rate

### Display Modes
- **Compact mode**: Essential information (default)
- **Verbose mode**: Detailed information including tick counts and processing rates
- **Silent mode**: No progress display (for automated runs)

### Configurable Updates
- **Tick-based updates**: Update every N ticks processed
- **Time-based updates**: Update every N seconds
- **Hybrid approach**: Updates when either condition is met

## Configuration Options

The progress tracking behavior can be customized using the `set_config()` method:

```python
simulator.set_config(
    show_progress_bar=True,         # Enable/disable progress display
    verbose_progress=False,         # Show detailed information
    progress_update_frequency=100,  # Update every N ticks
    progress_time_frequency=1.0     # Update every N seconds
)
```

### Configuration Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `show_progress_bar` | bool | True | Enable/disable progress display |
| `verbose_progress` | bool | False | Show detailed tick counts and rates |
| `progress_update_frequency` | int | 100 | Update every N ticks |
| `progress_time_frequency` | float | 1.0 | Update every N seconds |

## Usage Examples

### Basic Usage (Default Settings)
```python
from src.execution.simulator import ExecutionSimulator

simulator = ExecutionSimulator("AAPL")
result = simulator.run_backtest("data.csv", strategy)
```

**Output:**
```
Starting backtest with 10,000 ticks...
--------------------------------------------------------------------------------
[████████████████████████████████████████] 100.0% | Orders Generated: 45, Trades Executed: 23 ETA: 0s
--------------------------------------------------------------------------------
Backtest completed: 10,000 ticks processed | Orders Generated: 45 | Trades Executed: 23 | Avg Rate: 5000 ticks/s | Total Time: 2.0s
--------------------------------------------------------------------------------
```

### Verbose Mode
```python
simulator.set_config(
    verbose_progress=True,
    progress_update_frequency=50
)
result = simulator.run_backtest("data.csv", strategy)
```

**Output:**
```
Starting backtest with 10,000 ticks...
--------------------------------------------------------------------------------
[████████████████████████████████████████] 100.0% | Ticks: 10,000/10,000 | Orders Generated: 45 | Trades Executed: 23 | Rate: 5000 ticks/s
--------------------------------------------------------------------------------
Backtest completed: 10,000 ticks processed | Orders Generated: 45 | Trades Executed: 23 | Avg Rate: 5000 ticks/s | Total Time: 2.0s
--------------------------------------------------------------------------------
```

### High-Frequency Updates
```python
simulator.set_config(
    progress_update_frequency=25,   # More frequent updates
    progress_time_frequency=0.5     # Update every half second
)
result = simulator.run_backtest("data.csv", strategy)
```

### Silent Mode (No Progress Display)
```python
simulator.set_config(show_progress_bar=False)
result = simulator.run_backtest("data.csv", strategy)
```

## Implementation Details

### Progress Tracking Architecture

The progress tracking system consists of several key components:

1. **Counter Variables**:
   - `orders_generated_count`: Total orders generated during backtest
   - `trades_executed_count`: Total trades executed during backtest  
   - `ticks_processed_count`: Total ticks processed

2. **Timing Variables**:
   - `start_time`: Backtest start timestamp
   - `last_progress_update_time`: Last update timestamp
   - `last_progress_update_ticks`: Last update tick count

3. **Display Methods**:
   - `_init_progress_tracking()`: Initialize progress tracking
   - `_update_progress_display()`: Conditionally update display
   - `_display_progress()`: Render progress information
   - `_finalize_progress_display()`: Show final summary

### Tick Processing Integration

The progress tracking is integrated into the main backtest loop through the `_process_tick()` method:

```python
def _process_tick(self, row, strategy, result):
    """Process a single tick with progress tracking"""
    # Process market data
    self._process_market_update(row, result)
    
    # Track orders/trades before and after strategy execution
    orders_before = len(result.orders)
    trades_before = len(result.trades)
    
    self._execute_strategy_logic(strategy, result)
    
    # Update counters
    self.orders_generated_count += len(result.orders) - orders_before
    self.trades_executed_count += len(result.trades) - trades_before
```

### Performance Considerations

The progress tracking system is designed to minimize performance impact:

- **Conditional updates**: Only updates display when thresholds are met
- **Efficient calculations**: Minimal computational overhead per tick
- **Buffer flushing**: Uses `sys.stdout.flush()` for immediate display
- **Configurable frequency**: Allows tuning update frequency for performance

## Best Practices

### For Development and Testing
```python
# High-frequency updates for detailed monitoring
simulator.set_config(
    verbose_progress=True,
    progress_update_frequency=50,
    progress_time_frequency=0.5
)
```

### For Production Backtests
```python
# Standard settings for good balance of information and performance
simulator.set_config(
    verbose_progress=False,
    progress_update_frequency=100,
    progress_time_frequency=1.0
)
```

### For Automated/Batch Processing
```python
# Minimal output for automated systems
simulator.set_config(show_progress_bar=False)
```

### For Large Datasets
```python
# Less frequent updates to reduce overhead
simulator.set_config(
    progress_update_frequency=1000,
    progress_time_frequency=5.0
)
```

## Integration with Logging

The progress tracking works alongside the existing logging system:

- Progress display uses `stdout` for real-time updates
- Logging continues to use the configured logger
- Final summary is also logged at INFO level
- No interference between progress display and log output

## Testing

Use the provided test script to verify progress tracking functionality:

```bash
python test_progress_tracking.py
```

This script demonstrates:
- Different configuration modes
- Various update frequencies
- Order and trade counting accuracy
- Performance with different dataset sizes

## Troubleshooting

### Progress Bar Not Displaying
- Ensure `show_progress_bar=True` in configuration
- Check that stdout is not redirected
- Verify terminal supports Unicode characters (█, ░)

### Inaccurate Counters
- Verify strategy is properly returning orders
- Check that matching engine is processing orders correctly
- Enable verbose logging to debug order/trade flow

### Performance Issues
- Increase `progress_update_frequency` for less frequent updates
- Increase `progress_time_frequency` for time-based throttling
- Consider disabling progress display for maximum performance

## Future Enhancements

Potential future improvements to the progress tracking system:

- **Memory usage tracking**: Display current memory consumption
- **Strategy-specific counters**: Track orders/trades per strategy
- **Historical progress graphs**: Visual charts of progress over time
- **Network-based monitoring**: Remote progress monitoring capabilities
- **Custom progress callbacks**: User-defined progress handlers
